<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.xindian.wx_pay.mapper.OrderInfoMapper">

    <resultMap id="BaseResultMap" type="com.ruoyi.xindian.wx_pay.domain.OrderInfo">
            <id property="id" column="id" jdbcType="VARCHAR"/>
            <result property="title" column="title" jdbcType="VARCHAR"/>
            <result property="orderNo" column="order_no" jdbcType="VARCHAR"/>
            <result property="userId" column="user_id" jdbcType="BIGINT"/>
            <result property="totalFee" column="total_fee" jdbcType="DECIMAL"/>
            <result property="codeUrl" column="code_url" jdbcType="VARCHAR"/>
            <result property="orderStatus" column="order_status" jdbcType="VARCHAR"/>
            <result property="openId" column="open_id" jdbcType="VARCHAR"/>
        <result property="addressId" column="address_id" jdbcType="BIGINT"/>
            <result property="createTime" column="create_time" jdbcType="TIMESTAMP"/>
            <result property="updateTime" column="update_time" jdbcType="TIMESTAMP"/>
    </resultMap>

    <resultMap id="ResultMap" type="com.ruoyi.xindian.wx_pay.domain.OrderInfo" extends="BaseResultMap">
        <association property="shipAddress" javaType="shipAddress" resultMap="com.ruoyi.xindian.shipAddress.mapper.ShipAddressMapper.ShipAddressResult">
        </association>
        <collection property="suborderOrderInfos" ofType="suborderOrderInfo" resultMap="com.ruoyi.xindian.wx_pay.mapper.SuborderOrderInfoMapper.ResultMap">
        </collection>

    </resultMap>
    <resultMap id="Map" type="com.ruoyi.xindian.wx_pay.domain.OrderInfo" extends="BaseResultMap">
        <association property="shipAddress" javaType="shipAddress" resultMap="com.ruoyi.xindian.shipAddress.mapper.ShipAddressMapper.ShipAddressResult">
        </association>
        <collection property="suborderOrderInfos" ofType="suborderOrderInfo" resultMap="com.ruoyi.xindian.wx_pay.mapper.SuborderOrderInfoMapper.ResultMap">
        </collection>

    </resultMap>
    <resultMap id="AddressResultMap" type="com.ruoyi.xindian.wx_pay.domain.OrderInfo" extends="BaseResultMap">
        <association property="shipAddress" javaType="shipAddress" resultMap="com.ruoyi.xindian.shipAddress.mapper.ShipAddressMapper.ShipAddressResult">
        </association>
    </resultMap>
    <resultMap id="UserAndOrder" type="com.ruoyi.xindian.wx_pay.domain.OrderInfo" extends="BaseResultMap">
        <association property="sysUser" javaType="sysUser" resultMap="com.ruoyi.system.mapper.SysUserMapper.SysUserResult">

        </association>
    </resultMap>


    <sql id="Base_Column_List">
        id,title,order_no,
        user_id,product_id,
        total_fee,code_url,order_status,
        open_id,address_id,create_time,update_time
    </sql>
    <select id="selectAllList" resultType="com.ruoyi.xindian.wx_pay.domain.OrderInfo" resultMap="ResultMap">
        SELECT
            shipAddress.address_id,
            shipAddress.patient_name,
            shipAddress.patient_phone,
            shipAddress.state,
            shipAddress.city,
            shipAddress.country,
            shipAddress.street_address,
            shipAddress.postal_code,
            shipAddress.street,
            t_order_info.id,
            t_order_info.title,
            t_order_info.total_fee,
            t_order_info.order_status,
            t_order_info.create_time,
            t_suborder_order_info.suborder_id,
            t_suborder_order_info.product_id,
            t_suborder_order_info.sum,
            t_product.product_id,
            t_product.product_name,
            t_product.price,
            t_product.product_url,
            t_product.product_description,
            t_product.discount,
            t_product.sales
        FROM
            user_address
                INNER JOIN
            t_order_info
            ON
                shipAddress.address_id = t_order_info.address_id
                INNER JOIN
            t_suborder_order_info
            ON
                t_order_info.id = t_suborder_order_info.order_father,
            t_product
        where t_order_info.user_id = #{userId}
    </select>
    <select id="selectWebAllList" resultType="com.ruoyi.xindian.wx_pay.domain.OrderInfo" resultMap="UserAndOrder">


        SELECT
            t_order_info.id,
            t_order_info.title,
            t_order_info.order_no,
            t_order_info.open_id,
            t_order_info.create_time,
            t_order_info.order_status,
            sys_user.nick_name,
            sys_user.phonenumber
        FROM
            t_order_info
                INNER JOIN
            sys_user
            ON
                t_order_info.user_id = sys_user.user_id

        <where>
            <if test="orderId!=null&amp;&amp;orderId!=''">
                and t_order_info.id like concat('%',#{orderId},'%')
            </if>
            <if test="orderState!=null&amp;&amp;orderState!=''">
                and t_order_info.order_status = #{orderState}
            </if>
            <if test="userPhone!=null&amp;&amp;userPhone!=''">
                and sys_user.phonenumber like concat('%',#{userPhone},'%')
            </if>
        </where>


    </select>
    <select id="selectTOrderInfoById" resultType="com.ruoyi.xindian.wx_pay.domain.OrderInfo" resultMap="AddressResultMap">
        SELECT
            t_order_info.id,
            t_order_info.title,
            t_order_info.order_status,
            t_order_info.total_fee,
            shipAddress.address_id,
            shipAddress.patient_name,
            shipAddress.patient_phone,
            shipAddress.state,
            shipAddress.city,
            shipAddress.country,
            shipAddress.street_address,
            shipAddress.postal_code,
            shipAddress.user_id,
            shipAddress.street,
            shipAddress.default_flag
        FROM
            shipAddress
                INNER JOIN
            t_order_info
            ON
                shipAddress.address_id = t_order_info.address_id
        where t_order_info.id = #{orderId}
    </select>
    <select id="searchAllById" resultType="com.ruoyi.xindian.wx_pay.domain.OrderInfo" resultMap="ResultMap">
        SELECT
            shipAddress.address_id,
            shipAddress.patient_name,
            shipAddress.patient_phone,
            shipAddress.state,
            shipAddress.city,
            shipAddress.country,
            shipAddress.street_address,
            shipAddress.postal_code,
            shipAddress.user_id,
            shipAddress.street,
            shipAddress.default_flag,
            t_order_info.id,
            t_order_info.title,
            t_order_info.total_fee,
            t_order_info.order_status,
            t_order_info.create_time,
            t_suborder_order_info.suborder_id,
            t_suborder_order_info.product_id,
            t_suborder_order_info.sum,
            t_product.product_id,
            t_product.product_name,
            t_product.price,
            t_product.product_url,
            t_product.product_description,
            t_product.discount,
            t_product.sales
        FROM
            shipAddress
                INNER JOIN
            t_order_info
            ON
                shipAddress.address_id = t_order_info.address_id
                INNER JOIN
            t_suborder_order_info
            ON
                t_order_info.id = t_suborder_order_info.order_father,
            t_product
        where t_order_info.id = #{id}



    </select>
</mapper>
